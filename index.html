<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>IMediaC Kids â€“ Learn, Play & Grow</title>
    <meta name="description" content="IMediaC Kids: Islamic values, Quran, hadith, duas, stories, games and quizzes for children." />
    <link rel="stylesheet" href="styles.css" />
    <!-- Use local SVG favicon to avoid 404s -->
    <link rel="icon" href="assets/favicon.svg" type="image/svg+xml" />
    <!-- Fonts for Arabic (Amiri) and clean UI (Inter) -->
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  </head>
  <body class="theme-clouds">
    <header class="site-header">
      <!-- Top Moving Announcement Bar -->
      <div class="announcement-bar" aria-label="Announcements">
        <div class="announcement-track">
          <span>Welcome to Islam Media Central â€” Your Hub for Quran, Hadith, and Islamic Knowledge â€¢ </span>
          <span>Listen to Live Radio | Join Kids Competitions | New Podcasts Uploaded Weekly! â€¢ </span>
          <span>Download Our Mobile App Coming Soon! â€¢ </span>
        </div>
      </div>
      <div class="container header-inner">
        <div class="logo-title">
          <div class="logo-circle">ğŸŒŸ</div>
          <h1 class="site-title">IMediaC Kids</h1>
        </div>
        <nav class="nav">
          <a href="index.html" class="nav-link active">ğŸ  Home</a>
          <a href="games.html" class="nav-link">ğŸ® Games & ğŸ§  Quizzes</a>
          <a href="leaderboard.html" class="nav-link">ğŸ† Leaderboard</a>
          <a href="stories.html" class="nav-link">ğŸ“– Stories</a>
          <a href="quran.html" class="nav-link">ğŸ“— Quran</a>
          <a href="learn.html" class="nav-link">ğŸŒ™ Learn</a>
          <a href="prizes.html" class="nav-link">ğŸ Prizes</a>
          <a href="contact.html" class="nav-link">ğŸ“© Contact</a>
          <a href="auth.html" class="nav-link btn btn-outline">Join Now</a>
        </nav>
        <!-- Header Controls: Language & Theme toggles -->
        <div class="header-controls">
          <button id="langToggle" class="btn btn-outline" type="button" aria-label="Toggle language">EN / Ø§Ø±Ø¯Ùˆ</button>
          <button id="themeToggle" class="btn btn-outline" type="button" aria-label="Toggle theme">â˜€ï¸ / ğŸŒ™</button>
        </div>
      </div>
    </header>

    <!-- Hero Section (Full-width Slider) -->
    <section id="homeSlider" class="hero-slider full-bleed" aria-label="Main Features">
      <div class="slider" role="region" aria-roledescription="carousel" aria-label="Main Features">
        <div class="slides" id="sliderSlides">
          <!-- Populated by scripts/main.js -->
        </div>
        <button class="slider-nav prev" id="sliderPrev" aria-label="Previous">â€¹</button>
        <button class="slider-nav next" id="sliderNext" aria-label="Next">â€º</button>
        <div class="slider-dots" id="sliderDots" aria-label="Slide indicators"></div>
      </div>
    </section>

    <main class="container">
      <section class="hero">
        <h2>IMediaC Kids Zone â€“ Learn, Play & Grow</h2>
        <p>Safe, fun and structured Islamic learning with games, quizzes and stories.</p>
        <div class="hero-actions">
          <a href="auth.html" class="btn btn-primary">Join Now</a>
          <a href="games.html" class="btn btn-secondary">Start Playing</a>
        </div>
      </section>

      <!-- Quran Ayah & Hadith of the Day -->
      <section class="card gradient-soft" id="qhd" aria-label="Quran Ayah & Hadith of the Day">
        <h2 class="section-title">Quran Ayah & Hadith of the Day</h2>
        <div class="grid daily-grid">
          <div class="card">
            <h3>Quran Ayah</h3>
            <div class="arabic" id="ayah">Loading Ayahâ€¦</div>
            <div class="daily-meta" id="ayahRef"></div>
            <div class="daily-actions">
              <button id="playAyahBtn" class="btn btn-secondary" type="button">â–¶ Play Audio</button>
              <button id="copyAyahBtn" class="btn btn-outline" type="button">â§‰ Copy</button>
              <button id="shareAyahBtn" class="btn btn-outline" type="button">â‡ª Share</button>
            </div>
          </div>
          <div class="card">
            <h3>Hadith</h3>
            <div class="arabic" id="hadith">Loading Hadithâ€¦</div>
            <div class="daily-meta" id="hadithRef"></div>
            <div class="daily-actions">
              <button id="copyHadithBtn" class="btn btn-outline" type="button">â§‰ Copy</button>
              <button id="shareHadithBtn" class="btn btn-outline" type="button">â‡ª Share</button>
            </div>
          </div>
        </div>
        <audio id="ayahAudio" preload="none" style="display:none"></audio>
      </section>

      <!-- Prayer Times Widget -->
      <section class="card" id="prayerTimes" aria-label="Prayer Times">
        <h2 class="section-title">Prayer Times</h2>
        <div class="prayer-controls" style="display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin:6px 0 10px;">
          <label for="prayerCity">City</label>
          <select id="prayerCity" class="input" aria-label="Select city">
            <option value="London">London</option>
            <option value="Birmingham">Birmingham</option>
            <option value="Manchester">Manchester</option>
            <option value="Leeds">Leeds</option>
            <option value="Bradford">Bradford</option>
            <option value="Glasgow">Glasgow</option>
            <option value="Luton">Luton</option>
          </select>
          <label for="prayerMethod">Method</label>
          <select id="prayerMethod" class="input" aria-label="Select calculation method">
            <option value="3">Muslim World League</option>
            <option value="1">Karachi (Hanafi)</option>
            <option value="2">ISNA</option>
            <option value="4">Umm al-Qura, Makkah</option>
            <option value="5">Egyptian</option>
            <option value="14">Moonsighting Committee</option>
          </select>
        </div>
  <div id="prayerStatus" class="muted" aria-live="polite">Loading prayer timesâ€¦</div>
        <div class="prayer-grid" id="prayerGrid" aria-live="polite"></div>
        <div class="prayer-next" id="prayerNext">Next: <span id="nextPrayerName">â€”</span> in <span id="nextPrayerCountdown">--:--:--</span></div>
        <div class="prayer-actions">
          <button id="prayerRefresh" class="btn btn-outline" type="button">Refresh</button>
          <a id="prayerMonthlyLink" class="btn btn-secondary" href="#" target="_blank" rel="noopener">View Monthly Timetable</a>
        </div>
      </section>

      <section class="stats" aria-label="Highlights">
        <div class="stat"><div class="num">12+</div><div class="label">Interactive Games</div></div>
        <div class="stat"><div class="num">7</div><div class="label">Learning Paths</div></div>
        <div class="stat"><div class="num">100+</div><div class="label">Active Learners</div></div>
        <div class="stat"><div class="num">Monthly</div><div class="label">Prizes & Badges</div></div>
      </section>

      <!-- Slider moved above as full-width hero -->

      <section id="radio" class="card" aria-label="Islamic Radio">
        <audio id="radioPlayer" preload="none" data-src="https://a4.asurahosting.com:7820/radio.mp3" style="display:none">
          Your browser does not support the audio element.
          <a href="https://a4.asurahosting.com:7820/radio.mp3" target="_blank" rel="noopener">Open stream</a>.
        </audio>
        <div class="radio-player" role="group" aria-label="Radio player">
          <div class="rp-header">
            <div class="rp-icon" aria-hidden="true">ğŸ“»</div>
            <div class="rp-text">
              <h2>Live Islamic Radio</h2>
              <p id="radioStatus" aria-live="polite">Stopped</p>
            </div>
          </div>
          <div class="rp-controls">
            <button id="radioToggleBtn" class="btn btn-primary" aria-label="Play">â–¶ Play</button>
            <button id="radioStopBtn" class="btn btn-outline" aria-label="Stop">â–  Stop</button>
            <button id="radioMuteBtn" class="btn btn-outline" aria-label="Mute">ğŸ”‡ Mute</button>
            <label class="rp-volume">
              Volume
              <input id="radioVolume" type="range" min="0" max="1" step="0.01" value="1" />
            </label>
          </div>
          <div class="rp-visualizer" aria-hidden="true">
            <span></span><span></span><span></span><span></span><span></span>
          </div>
        </div>
      </section>

      <section id="profileBox" class="card" aria-live="polite" style="margin-top:16px;">
        <!-- Filled by scripts/main.js: shows logged-in child's username, madrasah, age, and points -->
        <h2>Your Profile</h2>
        <p>Loading...</p>
      </section>

      <section class="icon-grid">
        <a class="icon-card" href="games.html" aria-label="Games">
          <div class="icon">ğŸ®</div>
          <h3>Games</h3>
          <p>Play fun HTML5 games and learn!</p>
        </a>
        <a class="icon-card" href="games.html#quiz" aria-label="Quizzes">
          <div class="icon">ğŸ§ </div>
          <h3>Quizzes</h3>
          <p>Answer daily and weekly Islamic quizzes.</p>
        </a>
        <a class="icon-card" href="stories.html" aria-label="Stories">
          <div class="icon">ğŸ“–</div>
          <h3>Stories</h3>
          <p>Moral stories with fun characters.</p>
        </a>
        <a class="icon-card" href="prizes.html" aria-label="Prizes">
          <div class="icon">ğŸ</div>
          <h3>Prizes</h3>
          <p>Win monthly badges, books and more!</p>
        </a>
        <a class="icon-card" href="quran.html" aria-label="Quran">
          <div class="icon">ğŸ“—</div>
          <h3>Quran</h3>
          <p>Read and listen verse-by-verse with translations.</p>
        </a>
        <a class="icon-card" href="learn.html" aria-label="Learn">
          <div class="icon">ğŸŒ™</div>
          <h3>Learn</h3>
          <p>Ayah, Hadith and Dua of the day.</p>
        </a>
      </section>

      <section class="cta">
        <p>Kids earn points for every quiz or game. Top 3 win monthly prizes!</p>
        <a href="leaderboard.html" class="btn btn-outline">View Leaderboard</a>
      </section>

      <section class="card">
        <h2 class="section-title">Core Values</h2>
        <div class="values-grid">
          <div class="card value-card"><div class="icon">â¤ï¸</div><h3>Love of Allah</h3><p>Build a loving bond through daily remembrance.</p></div>
          <div class="card value-card"><div class="icon">ğŸ¤</div><h3>Character (Akhlaq)</h3><p>Practice honesty, patience and kindness.</p></div>
          <div class="card value-card"><div class="icon">ğŸŒŸ</div><h3>Respect & Care</h3><p>Respect parents, teachers and community.</p></div>
        </div>
      </section>

      <section class="card">
        <h2 class="section-title">About Islam Media Central</h2>
        <p style="text-align:center;">Islam Media Central brings authentic Islamic content including Quran, Hadith, Podcasts, Kids Learning, and Radio â€” connecting Muslims worldwide through digital media.</p>
        <div class="learn-grid">
          <a class="icon-card" href="quran.html">ğŸ“— Quran with Translation</a>
          <a class="icon-card" href="learn.html">ğŸ“š Complete Hadith Books</a>
          <a class="icon-card" href="stories.html">ğŸ™ï¸ Podcasts & Nasheeds</a>
          <a class="icon-card" href="games.html">ğŸ§  Kids Learning Corner</a>
          <a class="icon-card" href="blog.html">ğŸ•‹ Islamic Blog & Articles</a>
          <a class="icon-card" href="#radio">ğŸ“» Live Radio Stream</a>
          <a class="icon-card" href="games.html#quiz">ğŸ® Islamic Quizzes & Competitions</a>
        </div>
      </section>

      <!-- Kids Zone Promo -->
      <section class="card kids-promo" aria-label="Kids Zone Preview">
        <div class="kids-promo-inner">
          <div class="kids-stars" aria-hidden="true"><span>â˜…</span><span>âœ¦</span><span>â˜…</span><span>âœ¦</span></div>
          <h2>Play & Learn â€“ Visit IMediaC Kids Zone</h2>
          <p>Colourful games, quizzes, stories and rewards for children.</p>
          <a href="https://imediackids.com" target="_blank" rel="noopener" class="btn btn-primary">Visit Kids Site</a>
        </div>
      </section>

      <section class="card">
        <h2 class="section-title">Monthly Learning Competition</h2>
        <p style="text-align:center;">Earn points by playing and learning. Win badges and prizes every month!</p>
        <div style="text-align:center;">
          <a href="leaderboard.html" class="btn btn-secondary">See Leaderboard</a>
          <a href="prizes.html" class="btn btn-outline">View Prizes</a>
        </div>
      </section>

      <section class="card">
        <h2 class="section-title">Join Our Community</h2>
        <p style="text-align:center;">Parents and kids learn together, share progress and celebrate wins.</p>
        <div style="text-align:center;">
          <a href="auth.html" class="btn btn-primary">Create Your Account</a>
        </div>
      </section>

      <section class="card" id="latestArticles">
        <h2 class="section-title">From Our Blog â€” IMediaC.com</h2>
        <p style="text-align:center;">Latest posts from our WordPress site</p>
        <div class="articles-grid" id="articlesGrid" aria-live="polite"></div>
        <div style="text-align:center; margin-top:8px;">
          <div id="articlesStatus" class="muted" role="status" aria-live="polite" style="display:none;"></div>
          <button id="articlesRetry" class="btn btn-outline" type="button" style="display:none; margin-top:8px;">Retry</button>
        </div>
        <div style="text-align:center; margin-top:12px;">
          <a href="https://imediac.com/" target="_blank" rel="noopener" class="btn btn-outline">View all articles</a>
        </div>
      </section>

      <!-- Apps Coming Soon -->
      <section class="card" id="appsComingSoon">
        <h2 class="section-title">Apps Coming Soon</h2>
        <p style="text-align:center;">Our official Islam Media Central App is coming soon â€” explore Quran, Hadith, Podcasts, and Kids Zone anytime, anywhere.</p>
        <div class="apps-grid">
          <div class="app-card">
            <div class="app-mockup">ğŸ“±</div>
            <h3>Android</h3>
            <p class="muted">Google Play (Coming Soon)</p>
          </div>
          <div class="app-card">
            <div class="app-mockup">ğŸ“±</div>
            <h3>iOS</h3>
            <p class="muted">App Store (Coming Soon)</p>
          </div>
        </div>
      </section>

      <!-- Quick Access Tabs -->
      <section class="quick-access" aria-label="Quick Access">
        <div class="tabs">
          <a href="#homeSlider" class="tab">Home</a>
          <a href="quran.html" class="tab">Quran</a>
          <a href="learn.html" class="tab">Hadith</a>
          <a href="#latestArticles" class="tab">Blog</a>
          <a href="games.html" class="tab">Kids Zone</a>
          <a href="stories.html" class="tab">Podcasts</a>
          <a href="contact.html" class="tab">Contact</a>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="container">
        <div class="footer-glow" aria-hidden="true"></div>
        <section class="newsletter">
          <h3>Join Our Community</h3>
          <form action="https://formsubmit.co/info@imediac.com" method="POST" target="_blank">
            <input type="hidden" name="_subject" value="Newsletter Signup" />
            <input type="hidden" name="_captcha" value="false" />
            <input type="email" name="email" placeholder="Enter your email" required />
            <button class="btn btn-secondary" type="submit">Subscribe</button>
          </form>
        </section>
        <div class="socials">
          <a href="https://youtube.com" target="_blank" rel="noopener" aria-label="YouTube">â–¶ï¸</a>
          <a href="https://instagram.com" target="_blank" rel="noopener" aria-label="Instagram">ğŸ“¸</a>
          <a href="https://tiktok.com" target="_blank" rel="noopener" aria-label="TikTok">ğŸµ</a>
          <a href="https://facebook.com" target="_blank" rel="noopener" aria-label="Facebook">ğŸ“˜</a>
          <a href="https://x.com" target="_blank" rel="noopener" aria-label="X/Twitter">ğ•</a>
        </div>
        <p>Contact: <a href="mailto:info@imediac.com">info@imediac.com</a></p>
        <p>Â© 2025 Islam Media Central â€“ Powered by IMediaC.com</p>
        <button id="scrollTopBtn" class="scroll-top" type="button" aria-label="Scroll to top">â†‘</button>
      </div>
    </footer>

    <script src="scripts/main.js"></script>
    <!-- Floating WhatsApp Contact Button -->
    <a id="whatsappFloat" class="whatsapp-float" href="https://wa.me/447447999284" target="_blank" rel="noopener" aria-label="Contact on WhatsApp">ğŸ“±</a>

    <!-- Newsletter Modal removed per request -->

    <!-- Floating Mini Player -->
    <div id="miniPlayer" class="mini-player" aria-live="polite" style="display:none;">
      <button id="miniPlayBtn" class="btn btn-secondary" type="button" aria-label="Play/Pause">â–¶</button>
      <span id="miniTrack">Live Radio</span>
      <button id="miniCloseBtn" class="btn btn-outline" type="button" aria-label="Close">âœ•</button>
    </div>
    <script>
      // Load latest 4 articles with images from backend feed endpoint
      (async function loadLatestArticles(){
        const grid = document.getElementById('articlesGrid');
        const statusEl = document.getElementById('articlesStatus');
        const retryBtn = document.getElementById('articlesRetry');
        if (!grid) return;
        const isLocal = location.hostname === 'localhost' || location.hostname.startsWith('127.');
        const API_BASE = isLocal ? 'http://localhost:3001/api' : (window.API_BASE || '/api');

        function setStatus(message, showRetry = false){
          if (statusEl) {
            statusEl.textContent = message || '';
            statusEl.style.display = message ? 'block' : 'none';
          }
          if (retryBtn) {
            retryBtn.style.display = showRetry ? 'inline-block' : 'none';
            retryBtn.disabled = !showRetry ? false : false;
          }
        }

        async function fetchAndRender(){
          setStatus('Loading latest articles...', false);
          try {
            // Primary: backend API
            const res = await fetch(`${API_BASE}/feed/latest?limit=4`);
            if (!res.ok) throw new Error(`Backend feed error: ${res.status}`);
            const data = await res.json();
            if (!data.success || !Array.isArray(data.items)) throw new Error('Invalid feed response');
            grid.innerHTML = data.items.map(item => articleCard(item)).join('');
            setStatus('', false);
          } catch (err) {
            console.warn('Primary feed failed, trying fallback proxy...', err);
            try {
              // Fallback for local preview: use AllOrigins CORS proxy to parse WordPress RSS on client
              const rssUrl = encodeURIComponent('https://imediac.com/feed');
              const res2 = await fetch(`https://api.allorigins.win/raw?url=${rssUrl}`);
              if (!res2.ok) throw new Error(`Proxy feed error: ${res2.status}`);
              const xmlText = await res2.text();
              const items = parseRssItems(xmlText).slice(0, 4);
              grid.innerHTML = items.map(item => articleCard(item)).join('');
              setStatus('', false);
            } catch (err2) {
              console.error('Articles load error (fallback failed):', err2);
              grid.innerHTML = '';
              setStatus('Could not load latest articles. Please try again.', true);
            }
          }
        }

        retryBtn?.addEventListener('click', () => {
          fetchAndRender();
        });

        fetchAndRender();

        function articleCard(item){
          const img = item.image ? sanitize(item.image) : 'assets/favicon.svg';
          const title = sanitize(item.title || 'Untitled');
          const excerpt = sanitize(item.excerpt || '');
          const link = sanitize(item.link || '#');
          return `
            <a class="article-card" href="${link}" target="_blank" rel="noopener" aria-label="${title}">
              <div class="article-image" style="background-image:url('${img}')"></div>
              <div class="article-content">
                <h3>${title}</h3>
                <p>${excerpt}</p>
              </div>
            </a>
          `;
        }

        function sanitize(str){
          return String(str).replace(/[&<>"']/g, s => ({
            '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'
          })[s]);
        }

        function parseRssItems(xmlText){
          try {
            const doc = new DOMParser().parseFromString(xmlText, 'application/xml');
            const itemNodes = Array.from(doc.querySelectorAll('item'));
            return itemNodes.map(node => {
              const title = textContent(node, 'title');
              const link = textContent(node, 'link');
              const pubDate = textContent(node, 'pubDate');
              const image = extractImageFromItem(node);
              const excerpt = buildExcerptFromItem(node);
              return { title, link, pubDate, image, excerpt };
            });
          } catch (e) {
            console.error('RSS parse error:', e);
            return [];
          }
        }

        function textContent(parent, selector){
          const el = parent.querySelector(selector);
          return el ? (el.textContent || '').trim() : '';
        }

        function buildExcerptFromItem(node){
          const cdata = node.querySelector('description');
          const content = node.querySelector('content\\:encoded');
          const text = (content ? content.textContent : (cdata ? cdata.textContent : '')) || '';
          const clean = stripHtml(text).trim();
          return clean.length > 180 ? clean.slice(0, 177) + 'â€¦' : clean;
        }

        function stripHtml(s){
          return s ? String(s).replace(/<[^>]*>/g, '') : '';
        }

        function extractImageFromItem(node){
          const enc = node.querySelector('enclosure');
          if (enc && enc.getAttribute('url')) return enc.getAttribute('url');
          const mediaContent = node.querySelector('media\\:content');
          if (mediaContent && mediaContent.getAttribute('url')) return mediaContent.getAttribute('url');
          const mediaThumb = node.querySelector('media\\:thumbnail');
          if (mediaThumb && mediaThumb.getAttribute('url')) return mediaThumb.getAttribute('url');
          const html = (node.querySelector('content\\:encoded') || node.querySelector('description'))?.textContent || '';
          const match = html.match(/<img[^>]+src=["']([^"']+)["']/i);
          return match && match[1] ? match[1] : null;
        }
      })();
    </script>
  </body>
</html>
